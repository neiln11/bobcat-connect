{% extends "base/base.html" %}

{% block content %}
<div class="container mt-4" style="max-width: 935px;">
    <header class="row mb-5 justify-content-center">
        <div class="col-12 text-center mb-3">
            <div class="ratio ratio-1x1 mx-auto" style="width: 150px;">
                {% if club.image_file and club.image_file != 'default_club.jpg' %}
                    <img src="{{ url_for('static', filename='posts/' + club.image_file) }}" 
                         class="rounded-circle img-thumbnail w-100 h-100" 
                         style="object-fit: cover;">
                {% else %}
                    <div class="rounded-circle bg-secondary d-flex align-items-center justify-content-center mx-auto border" 
                         style="width: 150px; height: 150px; font-size: 3rem; color: white;">
                        {{ club.name[0] }}
                    </div>
                {% endif %}
            </div>
        </div>

        <div class="col-md-8 text-center">
            <div class="d-flex align-items-center justify-content-center gap-3 mb-3">
                <h2 class="fw-light m-0">{{ club.name }}</h2>
                
                <form action="{{ url_for('student.toggle_follow', club_id=club.id) }}" method="POST" class="m-0">
                    {% if is_following %}
                        <button type="submit" class="btn btn-outline-secondary btn-sm fw-bold px-3">Unfollow</button>
                    {% else %}
                        <button type="submit" class="btn btn-primary btn-sm fw-bold px-3">Follow</button>
                    {% endif %}
                </form>
            </div>

            <ul class="list-inline mb-3">
                <li class="list-inline-item me-4">
                    <span class="fw-bold">{{ club.posts|length }}</span> posts
                </li>
                <li class="list-inline-item me-4">
                    <span class="fw-bold">{{ follower_count }}</span> followers
                </li>
                <li class="list-inline-item">
                    <span class="fw-bold">{{ club.member_count or 0 }}</span> members
                </li>
            </ul>

            <div class="club-bio mx-auto" style="max-width: 600px;">
                <div class="fw-bold text-primary mb-2">{{ club.category }}</div>
                <div style="white-space: pre-line;" class="mb-3">{{ club.description }}</div>
                
                <div class="text-muted small d-flex justify-content-center gap-3">
                    {% if club.location and club.location != 'TBD' %}
                        <div><i class="bi bi-geo-alt-fill text-danger"></i> {{ club.location }}</div>
                    {% endif %}
                    
                    {% if club.meeting_time and club.meeting_time != 'TBD' %}
                        <div><i class="bi bi-clock-fill text-primary"></i> {{ club.meeting_time }}</div>
                    {% endif %}
                </div>
            </div>
        </div>
    </header>

    <hr class="mb-0">

    <ul class="nav justify-content-center border-0 mb-4">
        <li class="nav-item border-top border-dark border-2 pt-2">
            <a class="nav-link text-white text-uppercase small fw-bold" href="#">
                <i class="bi bi-grid-3x3"></i> Posts
            </a>
        </li>
    </ul>

    {% if club.posts %}
        <div class="row g-4">
            {% for post in club.posts|sort(attribute='created_at', reverse=True) %}
            <div class="col-4">
                <div class="ratio ratio-1x1 position-relative group-post">
                    <img src="{{ url_for('static', filename='posts/' + post.image_file) }}" 
                         class="img-fluid object-fit-cover" 
                         alt="Post"
                         onerror="this.src='https://via.placeholder.com/300'">
                    
                    <div class="post-overlay d-flex justify-content-center align-items-center text-white">
                        <div class="text-center px-2">
                            {% if post.is_event %}
                                <span class="badge bg-danger mb-2">EVENT</span>
                            {% endif %}
                            <p class="mb-1 small">{{ post.caption[:50] }}...</p>
                            <small class="opacity-75">{{ post.created_at.strftime('%b %d') }}</small>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    {% else %}
        <div class="text-center py-5">
            <div class="mb-3">
                <i class="bi bi-camera display-1 text-muted"></i>
            </div>
            <h3>No Posts Yet</h3>
            <p class="text-muted">When {{ club.name }} posts photos, they will appear here.</p>
        </div>
    {% endif %}

    {% if upcoming_events %}
    <div class="mt-5">
        <h4 class="mb-3 text-muted text-uppercase small fw-bold">Upcoming Events</h4>
        <div class="list-group shadow-sm">
            {% for event in upcoming_events %}
            <div class="list-group-item d-flex justify-content-between align-items-center p-3">
                <div class="d-flex align-items-center">
                    <div class="text-center me-3 text-danger border border-danger rounded p-2" style="width: 60px;">
                        <div class="small fw-bold">{{ event.event_date.strftime('%b') }}</div>
                        <div class="fs-4 fw-bold lh-1">{{ event.event_date.strftime('%d') }}</div>
                    </div>
                    <div>
                        <h6 class="mb-0">{{ event.event_title or 'Untitled Event' }}</h6>
                        <small class="text-muted">
                            <i class="bi bi-clock"></i> {{ event.event_date.strftime('%I:%M %p') }} | 
                            <i class="bi bi-geo-alt"></i> {{ event.event_location }}
                        </small>
                    </div>
                </div>
                <a href="{{ url_for('student.event_detail', post_id=event.id) }}" class="btn btn-sm btn-outline-primary">View</a>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}
</div>

<style>
    .post-overlay {
        position: absolute;
        top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(0,0,0,0.5);
        opacity: 0;
        transition: opacity 0.2s;
        cursor: pointer;
    }
    .group-post:hover .post-overlay {
        opacity: 1;
    }
    .object-fit-cover {
        object-fit: cover;
        width: 100%;
        height: 100%;
    }
</style>
{% endblock %}